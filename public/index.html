<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <div class="container">
        <h1>Fish Tracker</h1>
        <nav>
            <button onclick="loadPage('sign-in.html')">Sign In</button>
            <button onclick="loadPage('favorite-spots.html')" id="favoriteSpotsBtn" style="display: none;">Favorite Spots</button>
            <button onclick="loadPage('log-entry.html')" id="logEntryBtn" style="display: none;">Log Entry</button>
            <button onclick="loadPage('entries-folders.html')" id="entriesFoldersBtn" style="display: none;">Entries & Folders</button>
            <button onclick="logOut()" id="logoutBtn" style="display: none;">Log Out</button>
        </nav>
        <div id="content"></div>
        <p id="authStatus"></p>
    </div>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "your-actual-api-key",
            authDomain: "your-auth-domain.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket.appspot.com",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        let currentUser = null;

        window.loadPage = async function(page) {
            try {
                const response = await fetch(`/${page}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} - Could not load ${page}`);
                }
                const content = await response.text();
                document.getElementById('content').innerHTML = content;
                // Reinitialize scripts for the loaded page if needed
                if (page === 'favorite-spots.html') {
                    const script = document.createElement('script');
                    script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
                    script.defer = true;
                    document.body.appendChild(script);
                }
            } catch (err) {
                console.error('Error loading page:', err);
                document.getElementById('content').innerHTML = `<p>Error loading ${page}. Please try again. (${err.message})</p>`;
            }
        };

        function updateAuthStatus() {
            const authStatus = document.getElementById('authStatus');
            const favoriteSpotsBtn = document.getElementById('favoriteSpotsBtn');
            const logEntryBtn = document.getElementById('logEntryBtn');
            const entriesFoldersBtn = document.getElementById('entriesFoldersBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            if (currentUser) {
                authStatus.textContent = `Logged in as: ${currentUser.email}`;
                favoriteSpotsBtn.style.display = 'inline-block';
                logEntryBtn.style.display = 'inline-block';
                entriesFoldersBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'inline-block';
                loadPage('entries-folders.html'); // Default page after login
            } else {
                authStatus.textContent = 'Not logged in';
                favoriteSpotsBtn.style.display = 'none';
                logEntryBtn.style.display = 'none';
                entriesFoldersBtn.style.display = 'none';
                logoutBtn.style.display = 'none';
                loadPage('sign-in.html'); // Default page when logged out
            }
        }

        window.logOut = async function() {
            try {
                await signOut(auth);
                currentUser = null;
                updateAuthStatus();
                alert('Logged out successfully!');
            } catch (error) {
                alert('Error logging out: ' + error.message);
            }
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            updateAuthStatus();
        });

        // Initial load
        window.addEventListener('load', () => {
            updateAuthStatus(); // Ensure initial state is set
        });
    </script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>
</html>