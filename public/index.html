<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Tracker</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Fish Tracker</h1>

    <div id="userSection" class="hidden">
        <p>Welcome! You are logged in.</p>
        <button id="logoutBtn">Logout</button>
        <h2>Change Password</h2>
        <form id="changePasswordForm">
            <label>Old Password: <input type="password" name="oldPassword" required></label><br>
            <label>New Password: <input type="password" name="newPassword" required></label><br>
            <button type="submit">Update Password</button>
        </form>
        <p><a href="log-entry.html">Log a Catch</a></p>
        <p><a href="entries-folder.html">View Entries</a></p>
        <p><a href="favorite-spots.html">Favorite Spots</a></p>
    </div>

    <div id="guestSection">
        <p>Please <a href="sign-in.html">sign in</a> to continue.</p>
    </div>

    <script>
        const userSection = document.getElementById('userSection');
        const guestSection = document.getElementById('guestSection');
        const changePasswordForm = document.getElementById('changePasswordForm');
        const logoutBtn = document.getElementById('logoutBtn');

        // Check if logged in
        fetch('/api/user').then(res => res.json()).then(data => {
            if (data.loggedIn) {
                guestSection.classList.add('hidden');
                userSection.classList.remove('hidden');
            } else {
                userSection.classList.add('hidden');
                guestSection.classList.remove('hidden');
            }
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            fetch('/api/logout', { method: 'POST' }).then(res => res.json()).then(data => {
                window.location.href = data.redirect; // Redirect to sign-in.html
            });
        });

        // Change Password
        changePasswordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(changePasswordForm);
            fetch('/api/change-password', {
                method: 'POST',
                body: JSON.stringify({ 
                    oldPassword: formData.get('oldPassword'), 
                    newPassword: formData.get('newPassword') 
                }),
                headers: { 'Content-Type': 'application/json' }
            }).then(res => res.json()).then(data => {
                alert(data.message || data.error);
                if (data.message) changePasswordForm.reset();
            });
        });
    </script>
</body>
</html>